<div class="trello-profile-container">
  <!-- Trello-style Header -->
  <div class="trello-header">
    <div class="profile-avatar-section">
      <div class="avatar-circle">
        <span class="avatar-initials">{{ getInitials() }}</span>
      </div>
      <div class="profile-info">
        <h1 class="user-name">Cambia Password</h1>
        <span class="user-role-badge" [class]="'role-' + currentUser?.role">
          {{ currentUser?.role | titlecase }}
        </span>
      </div>
    </div>

    <button class="cancel-btn" (click)="onCancel()">
      <mat-icon>close</mat-icon>
      Annulla
    </button>
  </div>

  <!-- Decorative Separator -->
  <div class="separator-container">
    <div class="separator-line"></div>
    <div class="separator-icon">
      <mat-icon>lock</mat-icon>
    </div>
    <div class="separator-line"></div>
  </div>

  <!-- Trello-style Card -->
  <div class="trello-card">
    <div class="card-header">
      <h2>Modifica Password</h2>
    </div>

    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="password-form">
      <div class="card-content">
        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Password Attuale</mat-label>
            <input
              matInput
              formControlName="currentPassword"
              [type]="hideCurrentPassword ? 'password' : 'text'"
              placeholder="Inserisci la password attuale">
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="hideCurrentPassword = !hideCurrentPassword">
              <mat-icon>{{ hideCurrentPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
            <mat-error *ngIf="passwordForm.get('currentPassword')?.hasError('required')">
              La password attuale è obbligatoria
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Nuova Password</mat-label>
            <input
              matInput
              formControlName="newPassword"
              [type]="hideNewPassword ? 'password' : 'text'"
              placeholder="Inserisci la nuova password">
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="hideNewPassword = !hideNewPassword">
              <mat-icon>{{ hideNewPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
            <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('required')">
              La nuova password è obbligatoria
            </mat-error>
            <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('minlength')">
              La password deve essere di almeno 6 caratteri
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Conferma Nuova Password</mat-label>
            <input
              matInput
              formControlName="confirmPassword"
              [type]="hideConfirmPassword ? 'password' : 'text'"
              placeholder="Conferma la nuova password">
            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="hideConfirmPassword = !hideConfirmPassword">
              <mat-icon>{{ hideConfirmPassword ? 'visibility' : 'visibility_off' }}</mat-icon>
            </button>
            <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('required')">
              La conferma password è obbligatoria
            </mat-error>
            <mat-error *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched">
              Le password non corrispondono
            </mat-error>
          </mat-form-field>
        </div>

        <div class="security-info">
          <mat-icon class="security-icon">security</mat-icon>
          <div class="security-text">
            <p><strong>Suggerimenti per una password sicura:</strong></p>
            <ul>
              <li>Almeno 6 caratteri (meglio se 8+)</li>
              <li>Combina lettere maiuscole e minuscole</li>
              <li>Includi numeri e simboli</li>
              <li>Evita informazioni personali</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="passwordForm.invalid || isLoading"
          class="save-btn">
          <mat-icon>lock</mat-icon>
          {{ isLoading ? 'Cambiando...' : 'Cambia Password' }}
        </button>

        <button
          mat-button
          type="button"
          (click)="onCancel()"
          class="cancel-action-btn">
          <mat-icon>close</mat-icon>
          Annulla
        </button>
      </div>
    </form>
  </div>
</div>