<!-- Trello-Style Project Board -->
<div class="project-board-container">
  <!-- Enhanced Trello Header -->
  <div class="trello-board-header">
    <div class="header-top-bar">
      <div class="breadcrumb-section">
        <button mat-icon-button (click)="goBackToDashboard()" class="back-button">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="breadcrumb-path">
          <span class="breadcrumb-item">Dashboard</span>
          <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
          <span class="breadcrumb-current">{{ project?.name || 'Progetto' }}</span>
        </div>
      </div>

      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="openCreateIssueDialog()" *ngIf="canCreateIssue()" class="create-issue-btn">
          <mat-icon>add</mat-icon>
          Nuova Issue
        </button>
        <button mat-raised-button color="warn" (click)="openDeleteProjectDialog(project)" *ngIf="isPM()" class="delete-project-btn">
          <mat-icon>delete</mat-icon>
          Elimina Progetto
        </button>
      </div>
    </div>

    <div class="board-title-section">
      <div class="board-title-content">
        <h1 class="board-title">{{ project?.name || 'Caricamento...' }}</h1>
        <div class="board-badges">
          <div class="issues-count-badge">
            <mat-icon>assignment</mat-icon>
            <span>{{ getTotalIssuesCount() }} Issue</span>
          </div>
        </div>
      </div>
      <p class="board-description" *ngIf="project?.description">{{ project?.description }}</p>
    </div>
  </div>

  <!-- Enhanced Trello Kanban Board -->
  <div class="trello-kanban-board" *ngIf="project && !loading">
    <div class="trello-column" *ngFor="let column of kanbanColumns" [attr.data-status]="column.status">
      <!-- Enhanced Column Header -->
      <div class="trello-column-header" [class]="'header-' + column.status">
        <div class="column-title-section">
          <h3 class="column-title">{{ column.title }}</h3>
          <div class="column-count">{{ column.issues.length }}</div>
        </div>
      </div>

      <!-- Enhanced Column Content -->
      <div class="trello-column-content">
        <div class="trello-cards-list">
          <!-- Enhanced Trello Cards -->
          <div class="trello-card"
               *ngFor="let issue of column.issues"
               (click)="onIssueClick(issue)"
               [class]="'priority-' + issue.priority">

            <!-- Card Labels -->
            <div class="card-labels" *ngIf="issue.type || issue.priority">
              <div class="type-label" [class]="'type-' + issue.type">
                <mat-icon>{{ getTypeIcon(issue.type) }}</mat-icon>
                <span>{{ getTypeLabel(issue.type) }}</span>
              </div>
              <div class="priority-label" [class]="'priority-' + issue.priority">
                {{ getPriorityLabel(issue.priority) }}
              </div>
            </div>

            <!-- Card Title -->
            <h4 class="card-title">{{ issue.title }}</h4>

            <!-- Card Description -->
            <p class="card-description" *ngIf="issue.description">
              {{ issue.description }}
            </p>

            <!-- Card Meta Info -->
            <div class="card-meta">
              <div class="meta-badges">
                <div class="meta-badge" *ngIf="issue.estimated_hours">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ issue.estimated_hours }}h</span>
                </div>
                <div class="meta-badge" *ngIf="issue.due_date" [class.overdue]="isDueOverdue(issue.due_date)">
                  <mat-icon>event</mat-icon>
                  <span>{{ issue.due_date | date:'dd/MM' }}</span>
                </div>
              </div>
            </div>

            <!-- Card Footer -->
            <div class="card-footer">
              <div class="assignee-section">
                <div class="assignee-avatar" *ngIf="issue.assigned_to">
                  <div class="avatar-circle">
                    <span>{{ getAssigneeInitials(issue.assigned_to) }}</span>
                  </div>
                </div>
                <div class="no-assignee" *ngIf="!issue.assigned_to">
                  <mat-icon>person_add</mat-icon>
                </div>
              </div>

              <div class="card-actions">
                <button mat-icon-button
                        (click)="onIssueClick(issue); $event.stopPropagation()"
                        matTooltip="Visualizza dettagli"
                        class="card-action-btn view-btn">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button mat-icon-button
                        *ngIf="canEditIssue(issue)"
                        (click)="openEditIssueDialog(issue); $event.stopPropagation()"
                        matTooltip="Modifica"
                        class="card-action-btn edit-btn">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button
                        *ngIf="canDeleteIssue(issue)"
                        (click)="openDeleteIssueDialog(issue); $event.stopPropagation()"
                        matTooltip="Elimina"
                        class="card-action-btn delete-btn">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- Add Issue Card -->
          <div class="add-issue-card" (click)="openCreateIssueDialog()" *ngIf="canCreateIssue()">
            <mat-icon>add</mat-icon>
            <span>Aggiungi una issue</span>
          </div>

          <!-- Empty State -->
          <div class="empty-column-state" *ngIf="column.issues.length === 0">
            <mat-icon>inbox</mat-icon>
            <p>Nessuna issue</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading state -->
  <div class="loading-state" *ngIf="loading">
    <mat-icon>hourglass_empty</mat-icon>
    <p>Caricamento progetto e issue...</p>
  </div>

  <!-- Error state quando non c'Ã¨ il progetto e non stiamo caricando -->
  <div class="error-state" *ngIf="!project && !loading">
    <mat-icon>error_outline</mat-icon>
    <p>Errore nel caricamento del progetto</p>
    <button mat-raised-button color="primary" (click)="goBackToDashboard()">
      Torna alla Dashboard
    </button>
  </div>
</div>
